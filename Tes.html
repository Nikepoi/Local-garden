<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>Video Player HTML Generator — Fixed</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background: #f6f7fb; padding: 18px; font-family: Inter, system-ui, Arial; }
  .box { max-width:960px; margin:20px auto; background:#fff; padding:18px; border-radius:10px; box-shadow:0 8px 24px rgba(17,24,39,0.06) }
  h1{font-size:18px;margin-bottom:12px}
  .dynamic-field{display:flex;gap:8px;align-items:center;margin-bottom:8px}
  .dynamic-field input{flex:1}
  .small-muted{font-size:12px;color:#6b7b8c}
  textarea.form-control, input.form-control{background:#fbfdff}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;align-items:center}
  #result { font-family: monospace; white-space: pre-wrap; }
</style>
</head>
<body>
<div class="box">
  <h1>Video Player HTML Generator</h1>
  <input id="pageTitle" class="form-control mb-3" placeholder="Masukkan judul halaman..." value="">

  <div class="mb-3">
    <label class="form-label">Daftar Video (CDN URL + Original URL untuk download)</label>
    <div id="videosContainer">
      <!-- satu field default -->
    </div>
    <div class="controls">
      <button type="button" id="addVideo" class="btn btn-sm btn-primary">+ Tambah Video</button>
      <button type="button" id="clear" class="btn btn-sm btn-outline-secondary">Kosongkan Semua</button>
      <div class="small-muted">CDN URL untuk player, Original URL untuk tombol download. Kosongkan jika tidak ada.</div>
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label">Kode Iklan (opsional)</label>
    <textarea id="adCode" class="form-control" rows="4">(function(s){s.dataset.zone='10359853',s.src='https://al5sm.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</textarea>
    <div class="small-muted">Script iklan akan disisipkan apa adanya. Hapus isi textarea jika tidak ingin iklan.</div>
  </div>

  <div class="d-flex gap-2 mb-3">
    <button id="generate" class="btn btn-primary">Generate HTML</button>
    <button id="copyBtn" class="btn btn-success">Copy Hasil</button>
    <button id="downloadBtn" class="btn btn-outline-secondary">Download .html</button>
  </div>

  <div id="output" style="display:none;">
    <h6>Hasil HTML</h6>
    <textarea id="result" class="form-control" rows="16" readonly></textarea>
  </div>
</div>

<script>
// ==== Generator Script (halaman ini) ====
const addVideoBtn = document.getElementById('addVideo');
const videosContainer = document.getElementById('videosContainer');
const generateBtn = document.getElementById('generate');
const clearBtn = document.getElementById('clear');
const output = document.getElementById('output');
const resultTA = document.getElementById('result');
const copyBtn = document.getElementById('copyBtn');
const downloadBtn = document.getElementById('downloadBtn');
const pageTitleInput = document.getElementById('pageTitle');
const adCodeEl = document.getElementById('adCode');

function createVideoField() {
  const wrap = document.createElement('div');
  wrap.className = 'dynamic-field';
  wrap.innerHTML = `
    <input type="text" class="form-control" placeholder="CDN URL (untuk player)" value="">
    <input type="text" class="form-control" placeholder="Original URL (untuk download)" value="">
    <button type="button" class="btn btn-sm btn-danger btn-remove">-</button>
  `;
  videosContainer.appendChild(wrap);
}

// Hapus field
videosContainer.addEventListener('click', e => {
  if (e.target.classList.contains('btn-remove')) {
    const row = e.target.closest('.dynamic-field');
    if (row && videosContainer.children.length > 1) row.remove();
  }
});

addVideoBtn.addEventListener('click', createVideoField);

clearBtn.addEventListener('click', () => {
  pageTitleInput.value = '';
  adCodeEl.value = '';
  videosContainer.innerHTML = '';
  createVideoField();
  output.style.display = 'none';
  resultTA.value = '';
});

// ==== Bagian paling penting: generate HTML yang aman dari </script> ====
function buildGeneratedHTML(title, videos, adCode) {
  const videosJson = JSON.stringify(videos);

  let html = `<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>${title || 'Video Player'}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{font-family:Inter,system-ui,Arial;background:#071029;color:#fff;margin:0;padding:18px}
    .card{max-width:1100px;margin:auto;background:#081226;padding:20px;border-radius:10px}
    a{color:#8fb3ff;display:block;margin:8px 0}
    #player{margin:20px 0;padding:20px;background:#000;border-radius:8px;text-align:center;color:#ccc}
  </style>
</head>
<body>
<div class="card">
  <h2 class="text-center mb-4">${title || 'Video Player'}</h2>

  <div id="player">Pilih link download di bawah untuk memutar video (atau gunakan player eksternal).</div>

  <div style="margin-top:20px;font-size:14px;color:#9aa6b6">Download links:</div>
  <div id="links"></div>
</div>

<script>
// Data video yang di-embed
const videos = ${videosJson};

document.addEventListener('DOMContentLoaded', () => {
  const linksEl = document.getElementById('links');
  if (!videos || videos.length === 0) {
    linksEl.innerHTML = '<div style="color:#9aa6b6">Tidak ada video</div>';
    return;
  }

  videos.forEach(v => {
    if (!v.cdn && !v.original) return;

    const a = document.createElement('a');
    a.href = v.original || v.cdn || '#';
    a.target = '_blank';
    a.rel = 'noopener noreferrer';
    a.textContent = v.original || v.cdn || 'Link video';
    linksEl.appendChild(a);
  });
});
</script>`;

// Sisipkan iklan (jika ada) — langsung dimasukkan apa adanya
  if (adCode && adCode.trim()) {
    html += `\n<!-- Iklan -->\n${adCode.trim()}`;
  }

  html += `\n</body>\n</html>`;
  return html;
}

generateBtn.addEventListener('click', () => {
  const title = pageTitleInput.value.trim();
  const adCode = adCodeEl.value;

  const rows = videosContainer.querySelectorAll('.dynamic-field');
  const videos = Array.from(rows).map(row => {
    const inputs = row.querySelectorAll('input');
    return {
      cdn: inputs[0].value.trim(),
      original: inputs[1].value.trim()
    };
  }).filter(v => v.cdn || v.original); // hilangkan yang benar-benar kosong

  const generatedHtml = buildGeneratedHTML(title, videos, adCode);

  resultTA.value = generatedHtml;
  output.style.display = 'block';
  resultTA.focus();
  resultTA.select();
});

// Copy ke clipboard
copyBtn.addEventListener('click', () => {
  if (!resultTA.value) return alert('Belum ada hasil untuk dicopy');
  resultTA.select();
  if (navigator.clipboard) {
    navigator.clipboard.writeText(resultTA.value).then(() => alert('Berhasil dicopy!'));
  } else {
    document.execCommand('copy');
    alert('Berhasil dicopy (fallback)');
  }
});

// Download file HTML
downloadBtn.addEventListener('click', () => {
  if (!resultTA.value) return alert('Generate dulu HTML-nya');
  const blob = new Blob([resultTA.value], {type: 'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'video-player.html';
  a.click();
  URL.revokeObjectURL(url);
});

// Inisialisasi: satu field kosong
createVideoField();

</script>
</body>
</html>
